<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>地震情報</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>題名</h1>
  <div id="infoContainer" class="section">読み込み中...</div>

  <script>
    async function fetchLatestQuakeData() {
      try {
        const listRes = await fetch('https://www.jma.go.jp/bosai/quake/data/list.json');
        const listData = await listRes.json();
        const latestJsonFile = listData[0].json;

        const quakeRes = await fetch(`https://www.jma.go.jp/bosai/quake/data/${latestJsonFile}`);
        const quakeData = await quakeRes.json();

        const container = document.getElementById("infoContainer");
        let html = "";

        const control = quakeData.Control;
        const head = quakeData.Head;
        const body = quakeData.Body;
        const eq = body?.Earthquake;
        const int = body?.Intensity?.Observation;

        if (head?.InfoKind) {
          document.querySelector("h1").innerHTML = head.InfoKind;
        }

        if (control?.Title) {
          html += `<p><strong>詳細情報:</strong> ${control.Title}</p>`;
        }

        if (control?.EditorialOffice) {
          html += `<p><strong>編集官署:</strong> ${control.EditorialOffice}</p>`;
        }

        if (head?.InfoType && head?.Serial) {
          html += `<p><strong>情報種別:</strong> ${head.InfoType} ${head.Serial}</p>`;
        }

        if (eq?.Hypocenter?.Area?.Name) {
          html += `<p><strong>震源地:</strong> ${eq.Hypocenter.Area.Name}</p>`;
        }

        if (eq?.Hypocenter?.Area?.Code) {
          html += `<p><strong>震央コード:</strong> ${eq.Hypocenter.Area.Code}</p>`;
        }

        if (int?.MaxInt) {
          html += `<p><strong>最大震度:</strong> ${int.MaxInt}</p>`;
        }

        if (eq?.Magnitude) {
          html += `<p><strong>マグニチュード:</strong> ${eq.Magnitude}</p>`;
        }

        let lat = "不明", lon = "不明";
        const coordMatch = eq?.Hypocenter?.Area?.Coordinate?.match(/\+([0-9.]+)\+([0-9.]+)(-?[0-9]+)/);
        if (coordMatch) {
          lat = coordMatch[1];
          lon = coordMatch[2];
          html += `<p><strong>座標:</strong> 緯度 ${lat} / 経度 ${lon}</p>`;
        }

        let depth = "";
        if (coordMatch) {
          depth = Math.abs(parseInt(coordMatch[3], 10)) / 1000;
          html += `<p><strong>深さ:</strong> ${depth} km</p>`;
        }

        if (eq?.OriginTime) {
          html += `<p><strong>発生時刻:</strong> ${new Date(eq.OriginTime).toLocaleString()}</p>`;
        }

        if (head?.Headline?.Text) {
          html += `<p><strong>コメント:</strong> ${head.Headline.Text}</p>`;
        }

        if (body?.Comments?.ForecastComment?.Text) {
          html += `<p><strong>津波情報:</strong> ${body.Comments.ForecastComment.Text}</p>`;
        }

        if (control?.PublishingOffice) {
          html += `<p><strong>提供元:</strong> ${control.PublishingOffice}</p>`;
        }

        container.innerHTML = html;

      } catch (err) {
        document.getElementById("infoContainer").innerHTML = "エラー: " + err.message;
      }
    }

    fetchLatestQuakeData();
    setInterval(fetchLatestQuakeData, 1000);
  </script>
</body>
</html>
